<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Leitura do Ensaio</title>

<!-- PDF.js (CDN oficial da Mozilla – funciona no GitHub Pages) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
</script>

<style>
body {
    margin: 0;
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
}
#viewer-container {
    width: 100vw;
    height: 100vh;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
}
canvas {
    margin: 20px 0;
    box-shadow: 0 0 20px #000;
}
#topbar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    padding: 0 15px;
    z-index: 1000;
}
#topbar button {
    margin-right: 10px;
    padding: 7px 12px;
    background: #222;
    border: 1px solid #333;
    border-radius: 6px;
    color: #eee;
    cursor: pointer;
}
#topbar button:hover {
    background: #444;
}
#title {
    color: #fff;
    font-weight: bold;
    margin-left: auto;
    opacity: .8;
}
</style>

</head>
<body>

<div id="topbar">
    <button id="prev">◀</button>
    <button id="next">▶</button>
    <button id="zoomIn">＋</button>
    <button id="zoomOut">－</button>

    <div id="title">Carregando...</div>
</div>

<div id="viewer-container">
    <div id="viewer"></div>
</div>

<script>
/* ------------------------------
   1) Coleta ID da URL
--------------------------------*/
const params = new URLSearchParams(window.location.search);
const id = params.get("id") || "1";

/* ------------------------------
   2) Define caminho do PDF
--------------------------------*/
const pdfUrl = "pdfs/ensaio" + id + ".pdf";

/* Título dinâmico */
document.getElementById("title").innerText = "Ensaio " + id;

/* ------------------------------
   3) Configurações básicas do PDF
--------------------------------*/
let pdfDoc = null;
let currentPage = 1;
let scale = 1.25;

/* Elementos */
const viewer = document.getElementById("viewer");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const zoomInBtn = document.getElementById("zoomIn");
const zoomOutBtn = document.getElementById("zoomOut");

/* ------------------------------
   4) Renderiza página
--------------------------------*/
function renderPage(num) {
    pdfDoc.getPage(num).then(function(page) {
        const viewport = page.getViewport({ scale: scale });
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        viewer.innerHTML = "";
        viewer.appendChild(canvas);

        page.render({
            canvasContext: ctx,
            viewport: viewport
        });
    });
}

/* ------------------------------
    5) Navegação
--------------------------------*/
prevBtn.onclick = () => {
    if (currentPage <= 1) return;
    currentPage--;
    renderPage(currentPage);
};

nextBtn.onclick = () => {
    if (currentPage >= pdfDoc.numPages) return;
    currentPage++;
    renderPage(currentPage);
};

zoomInBtn.onclick = () => {
    scale += 0.15;
    renderPage(currentPage);
};

zoomOutBtn.onclick = () => {
    scale = Math.max(0.5, scale - 0.15);
    renderPage(currentPage);
};

/* ------------------------------
    6) Carrega PDF
--------------------------------*/
pdfjsLib.getDocument(pdfUrl).promise.then(function(pdf) {
    pdfDoc = pdf;
    renderPage(currentPage);
}).catch(err => {
    viewer.innerHTML =
      "<p style='color:white; padding:40px'>Não foi possível carregar o PDF do ensaio " +
      id +
      ".<br>Verifique se <strong>pdfs/ensaio" +
      id + ".pdf</strong> existe no GitHub.</p>";
});
</script>

</body>
</html>
