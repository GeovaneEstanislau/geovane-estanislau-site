<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Leitura de ensaios</title>

<!-- PDF.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
</script>

<style>
:root{
  --bg:#0b1220; --fg:#e6eef6; --muted:#9aa7b2;
  --accent:#2dd4bf; --panel:#07101a;
}
[data-theme="light"]{
  --bg:#ffffff; --fg:#111827; --muted:#6b7280;
  --accent:#0ea5a4; --panel:#f8fafc;
}
*{box-sizing:border-box}
body{
  margin:0;background:var(--bg);color:var(--fg);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
}
.viewer-root{
  height:100vh;display:flex;flex-direction:column;align-items:stretch;
}

/* Top controls */
.topbar{
  position:fixed;left:50%;transform:translateX(-50%);
  top:12px;background:rgba(0,0,0,0.45);
  backdrop-filter:blur(6px);padding:8px 12px;border-radius:10px;
  display:flex;gap:8px;align-items:center;
  z-index:1200;opacity:0;transition:opacity .18s ease,transform .18s ease;
}
.topbar.visible{
  opacity:1;transform:translateX(-50%) translateY(0);
}
.topbar button{
  background:transparent;border:1px solid rgba(255,255,255,0.06);
  color:var(--fg);padding:8px 10px;border-radius:8px;cursor:pointer;
}

/* central viewer */
.viewer-area{
  flex:1;display:flex;align-items:center;justify-content:center;
  padding:64px 24px 120px 24px;overflow:auto;
}
.pdf-page{
  box-shadow:0 18px 40px rgba(2,6,23,0.5);
  border-radius:8px;overflow:hidden;
}

/* placeholders */
.placeholder{
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:18px;color:var(--muted);
}
.center-msg{
  background:rgba(0,0,0,0.25);padding:22px;border-radius:12px;
  text-align:center;max-width:720px;
}

/* side page buttons */
.side-btn{
  position:fixed;top:50%;transform:translateY(-50%);
  background:rgba(0,0,0,0.25);
  border:1px solid rgba(255,255,255,0.06);
  color:var(--fg);padding:14px;border-radius:10px;cursor:pointer;
  backdrop-filter:blur(4px);z-index:1200;font-size:20px;
}
.side-btn.left{left:14px;}
.side-btn.right{right:14px;}
.side-btn:hover{background:rgba(0,0,0,0.45)}

/* spinner */
.spinner{
  width:64px;height:64px;border-radius:50%;
  display:inline-block;position:relative
}
.spinner:before{
  content:"";box-sizing:border-box;position:absolute;
  inset:0;border-radius:50%;
  border:6px solid rgba(255,255,255,0.08);
  border-top-color:var(--accent);animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}

/* misc */
.small{font-size:14px;color:var(--muted)}
canvas{max-width:100%;height:auto;display:block}
</style>
</head>
<body>

<div class="viewer-root" id="root">

  <!-- TOPBAR -->
  <div id="topbar" class="topbar" aria-hidden="true">
    <button id="btnZoomOut">−</button>
    <button id="btnZoomIn">＋</button>
    <button id="btnDownload">Baixar</button>

    <div style="width:12px"></div>
    <div id="meta" class="small">ensaios <span id="ensId">?</span></div>

    <!-- BOTÕES DE ensaios -->
    <button id="btnPrevEssay" style="margin-left:14px;">⬅ ensaios</button>
    <button id="btnNextEssay">ensaios ➡</button>
  </div>

  <!-- PAGE NAV -->
  <button id="prevBtn" class="side-btn left" title="Página anterior">◀</button>
  <button id="nextBtn" class="side-btn right" title="Próxima página">▶</button>

  <!-- VIEWER -->
  <div class="viewer-area" id="viewerArea"></div>
</div>

<script>
// helpers
const qs = s => document.querySelector(s);

// ensaios ID
const params = new URLSearchParams(window.location.search);
const id = params.get('id') || '1';
qs('#ensId').innerText = id;

// path do PDF
const pdfPath = '/pdfs/ensaios' + id + '.pdf';

// refs
const viewerArea = qs('#viewerArea');
const topbar = qs('#topbar');
const prevBtn = qs('#prevBtn');
const nextBtn = qs('#nextBtn');
const btnZoomIn = qs('#btnZoomIn');
const btnZoomOut = qs('#btnZoomOut');
const btnDownload = qs('#btnDownload');
const btnPrevEssay = qs('#btnPrevEssay');
const btnNextEssay = qs('#btnNextEssay');

// tema automático
(function(){
  const h = new Date().getHours();
  if(h>=6 && h<18) document.documentElement.setAttribute('data-theme','light');
  else document.documentElement.removeAttribute('data-theme');
})();

// mostrar topbar
let topTimer = null;
document.addEventListener('mousemove', e => {
  if(e.clientY < 140){
    topbar.classList.add('visible');
    topbar.setAttribute('aria-hidden','false');

    clearTimeout(topTimer);
    topTimer = setTimeout(()=>{
      topbar.classList.remove('visible');
      topbar.setAttribute('aria-hidden','true');
    }, 2200);
  }
});

// PDF.js
let pdfDoc = null;
let currentPage = 1;
let totalPages = 1;
let scale = 0.9;

// loading
function showLoading(){
  viewerArea.innerHTML = `
    <div class="placeholder">
      <div class="spinner"></div>
      <div class="small">Carregando...</div>
    </div>
  `;
}

// unavailable
function showUnavailable(){
  viewerArea.innerHTML = `
    <div class="placeholder">
      <div class="spinner"></div>
      <div class="center-msg"><strong>ensaio ainda não disponível</strong>
      <div class="small" style="margin-top:8px">
      Este ensaio será adicionado em breve. Volte mais tarde.
      </div></div>
    </div>
  `;
}

// render page
function renderPage(pg){
  if(!pdfDoc) return;

  pdfDoc.getPage(pg).then(page => {
    const viewport = page.getViewport({ scale });
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    canvas.width = viewport.width;
    canvas.height = viewport.height;
    canvas.className = 'pdf-page';

    viewerArea.innerHTML = '';
    viewerArea.appendChild(canvas);

    page.render({ canvasContext: ctx, viewport });
  });
}

// LOAD PDF
showLoading();
pdfjsLib.getDocument(pdfPath).promise.then(pdf => {
  pdfDoc = pdf;
  totalPages = pdf.numPages;
  renderPage(currentPage);
}).catch(err => {
  console.warn(err);
  showUnavailable();
});

// ZOOM
btnZoomIn.addEventListener('click', () => {
  scale = Math.min(3, scale + 0.15);
  renderPage(currentPage);
});
btnZoomOut.addEventListener('click', () => {
  scale = Math.max(0.4, scale - 0.15);
  renderPage(currentPage);
});

// Download
btnDownload.addEventListener('click', () => {
  window.open(pdfPath, '_blank');
});

// PAGE NAV
prevBtn.addEventListener('click', () => {
  if(currentPage > 1){
    currentPage--;
    renderPage(currentPage);
  }
});
nextBtn.addEventListener('click', () => {
  if(currentPage < totalPages){
    currentPage++;
    renderPage(currentPage);
  }
});

// ensaios NAV
btnPrevEssay.addEventListener('click', () => {
  const n = Number(id) - 1;
  if(n >= 1) window.location.href = 'ensaios.html?id=' + n;
});
btnNextEssay.addEventListener('click', () => {
  const n = Number(id) + 1;
  window.location.href = 'ensaios.html?id=' + n;
});
</script>

</body>
</html>
